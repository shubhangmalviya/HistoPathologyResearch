<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RQ2: Expert vs Unified Models - Statistical Analysis Report</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 40px; line-height: 1.6; color: #333; }
        h1 { color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 10px; }
        h2 { color: #34495e; border-left: 4px solid #3498db; padding-left: 15px; margin-top: 30px; }
        h3 { color: #2c3e50; }
        .highlight { background-color: #f8f9fa; padding: 15px; border-left: 4px solid #28a745; margin: 15px 0; }
        .warning { background-color: #fff3cd; padding: 15px; border-left: 4px solid #ffc107; margin: 15px 0; }
        .result { background-color: #d1ecf1; padding: 15px; border-left: 4px solid #17a2b8; margin: 15px 0; }
        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f2f2f2; font-weight: bold; }
        .center { text-align: center; }
        .right { text-align: right; }
        code { background-color: #f4f4f4; padding: 2px 4px; border-radius: 3px; font-family: 'Courier New', monospace; }
        .equation { font-style: italic; text-align: center; margin: 15px 0; }
        .file-ref { background-color: #e9ecef; padding: 8px; border-radius: 4px; font-family: monospace; font-size: 0.9em; }
        ul.checklist { list-style-type: none; }
        ul.checklist li:before { content: "‚úì "; color: #28a745; font-weight: bold; }
    </style>
</head>
<body>

<h1>Research Question 2: Statistical Analysis Report</h1>
<p><strong>Do expert segmentation models trained individually per tissue or cell type outperform unified models trained across all PanNuke classes when their predictions are ensembled?</strong></p>

<div class="result">
    <h3>üéØ Key Finding</h3>
    <p><strong>No evidence that expert models outperform unified models.</strong> The unified model demonstrated superior performance across all evaluated metrics, with the exception of Breast tissue where expert models showed modest advantage.</p>
</div>

<h2>1. Statistical Methods Justification</h2>

<h3>1.1 Why Wilcoxon Signed-Rank Test?</h3>
<div class="highlight">
    <p><strong>Primary Choice Rationale:</strong></p>
    <ul class="checklist">
        <li><strong>Paired Design:</strong> Each image patch has predictions from both expert and unified models, creating natural pairs</li>
        <li><strong>Non-parametric:</strong> PQ differences may not follow normal distribution; Wilcoxon doesn't assume normality</li>
        <li><strong>Robust to Outliers:</strong> Segmentation metrics can have extreme values; rank-based tests are more robust</li>
        <li><strong>One-sided Test:</strong> Our hypothesis specifically tests if expert > unified (directional)</li>
        <li><strong>Effect Size:</strong> Rank-biserial correlation provides interpretable effect magnitude</li>
    </ul>
</div>

<h3>1.2 Why Not Other Tests?</h3>
<table>
    <tr>
        <th>Alternative Test</th>
        <th>Why Not Chosen</th>
        <th>When It Would Be Appropriate</th>
    </tr>
    <tr>
        <td>Paired t-test</td>
        <td>Assumes normality of differences; segmentation metrics often skewed</td>
        <td>If differences were normally distributed</td>
    </tr>
    <tr>
        <td>Mann-Whitney U</td>
        <td>For independent groups; our data is paired by image</td>
        <td>Comparing two independent model groups</td>
    </tr>
    <tr>
        <td>McNemar's test</td>
        <td>For binary outcomes; our metrics are continuous</td>
        <td>If testing success/failure rates</td>
    </tr>
    <tr>
        <td>ANOVA</td>
        <td>Comparing multiple independent groups; we have paired data</td>
        <td>Multiple independent model architectures</td>
    </tr>
    <tr>
        <td>Permutation test</td>
        <td>Computationally intensive; Wilcoxon provides similar robustness</td>
        <td>When exact p-values needed for small samples</td>
    </tr>
</table>

<h3>1.3 Why Mixed-Effects Model as Secondary Analysis?</h3>
<div class="highlight">
    <p><strong>Tissue Clustering Concern:</strong> Images within the same tissue type may be more similar to each other than to images from other tissues, violating independence assumptions.</p>
    <p><strong>Solution:</strong> Mixed-effects model with tissue as random intercept accounts for this clustering, providing cluster-robust inference.</p>
</div>

<h3>1.4 Why Benjamini-Hochberg (BH) Correction?</h3>
<table>
    <tr>
        <th>Multiple Testing Method</th>
        <th>Control Rate</th>
        <th>Power</th>
        <th>Our Choice</th>
    </tr>
    <tr>
        <td>Bonferroni</td>
        <td>Family-wise Error Rate (FWER)</td>
        <td>Low (conservative)</td>
        <td>‚ùå Too conservative for exploratory analysis</td>
    </tr>
    <tr>
        <td>Benjamini-Hochberg</td>
        <td>False Discovery Rate (FDR)</td>
        <td>Higher than Bonferroni</td>
        <td>‚úÖ Balances Type I/II error appropriately</td>
    </tr>
    <tr>
        <td>No correction</td>
        <td>None</td>
        <td>Highest</td>
        <td>‚ùå Inflated Type I error with 4 metrics</td>
    </tr>
</table>

<h2>2. Sample Size and Power Analysis</h2>

<table>
    <tr>
        <th>Characteristic</th>
        <th>Value</th>
        <th>Interpretation</th>
    </tr>
    <tr>
        <td>Total image patches analyzed</td>
        <td class="center">1,016</td>
        <td>Large sample provides good statistical power</td>
    </tr>
    <tr>
        <td>Number of tissue types</td>
        <td class="center">5</td>
        <td>Sufficient diversity for generalization</td>
    </tr>
    <tr>
        <td>Median patches per tissue</td>
        <td class="center">88</td>
        <td>Balanced representation across tissues</td>
    </tr>
    <tr>
        <td>Range per tissue</td>
        <td class="center">84-471</td>
        <td>Breast tissue overrepresented (handled by mixed-effects)</td>
    </tr>
    <tr>
        <td>Minimum detectable effect (80% power)</td>
        <td class="center">0.0134 PQ units</td>
        <td>Can detect small but meaningful differences</td>
    </tr>
    <tr>
        <td>Cohen's d_z equivalent</td>
        <td class="center">0.078</td>
        <td>Small-to-medium effect size detectable</td>
    </tr>
</table>

<div class="warning">
    <p><strong>Power Interpretation:</strong> With n=1,016, we have 80% power to detect differences as small as 0.0134 PQ units. Our observed difference (-0.0147) exceeds this threshold, indicating sufficient power to detect the effect.</p>
</div>

<h2>3. Primary Statistical Results</h2>

<h3>3.1 Wilcoxon Signed-Rank Test (Primary Analysis)</h3>
<table>
    <tr>
        <th>Statistic</th>
        <th>Value</th>
        <th>Interpretation</th>
    </tr>
    <tr>
        <td>Test statistic (W)</td>
        <td class="right">168,008</td>
        <td>Sum of ranks for positive differences</td>
    </tr>
    <tr>
        <td>p-value (one-sided)</td>
        <td class="right">1.000</td>
        <td>No evidence expert > unified</td>
    </tr>
    <tr>
        <td>Median difference (Œî)</td>
        <td class="right">-0.0147</td>
        <td>Unified model superior by 0.0147 PQ units</td>
    </tr>
    <tr>
        <td>95% Bootstrap CI</td>
        <td class="right">[-0.0238, -0.0062]</td>
        <td>Significant advantage for unified model</td>
    </tr>
    <tr>
        <td>Rank-biserial correlation (r)</td>
        <td class="right">-0.276</td>
        <td>Small-to-medium effect favoring unified</td>
    </tr>
</table>

<div class="equation">
    <p><strong>Effect Size Interpretation:</strong><br>
    r = -0.276 indicates that 27.6% more comparisons favor the unified model over expert models</p>
</div>

<h3>3.2 Mixed-Effects Analysis (Secondary)</h3>
<table>
    <tr>
        <th>Parameter</th>
        <th>Estimate</th>
        <th>95% CI</th>
        <th>p-value</th>
    </tr>
    <tr>
        <td>Mean difference (tissue-adjusted)</td>
        <td class="right">-0.124</td>
        <td class="right">[-0.279, 0.032]</td>
        <td class="right">0.954</td>
    </tr>
</table>

<div class="highlight">
    <p><strong>Mixed-Effects Interpretation:</strong> After accounting for tissue clustering, the mean difference remains negative (favoring unified model) but confidence interval includes zero, consistent with the primary Wilcoxon test.</p>
</div>

<h2>4. Multiple Comparisons Results</h2>

<table>
    <tr>
        <th>Metric</th>
        <th>Median Œî (Expert - Unified)</th>
        <th>p (one-sided)</th>
        <th>q (BH-FDR)</th>
        <th>Significant?</th>
        <th>Favors</th>
    </tr>
    <tr>
        <td><strong>PQ (Primary)</strong></td>
        <td class="right">-0.0147</td>
        <td class="right">1.000</td>
        <td class="right">1.000</td>
        <td class="center">‚ùå</td>
        <td>Unified</td>
    </tr>
    <tr>
        <td>Dice</td>
        <td class="right">-0.0999</td>
        <td class="right">1.000</td>
        <td class="right">1.000</td>
        <td class="center">‚ùå</td>
        <td>Unified</td>
    </tr>
    <tr>
        <td>AJI</td>
        <td class="right">-0.0040</td>
        <td class="right">0.998</td>
        <td class="right">1.000</td>
        <td class="center">‚ùå</td>
        <td>Unified</td>
    </tr>
    <tr>
        <td>F1</td>
        <td class="right">-0.0166</td>
        <td class="right">1.000</td>
        <td class="right">1.000</td>
        <td class="center">‚ùå</td>
        <td>Unified</td>
    </tr>
</table>

<div class="result">
    <p><strong>Consistent Pattern:</strong> All metrics show the same direction of effect (unified > expert), providing strong evidence for the superiority of the unified approach.</p>
</div>

<h2>5. Tissue-Specific Analysis</h2>

<table>
    <tr>
        <th>Tissue</th>
        <th>n</th>
        <th>Mean Œî (Expert - Unified)</th>
        <th>95% CI</th>
        <th>Favors</th>
        <th>Effect Magnitude</th>
    </tr>
    <tr style="background-color: #d4edda;">
        <td>Breast</td>
        <td class="center">471</td>
        <td class="right">+0.043</td>
        <td class="right">[0.034, 0.053]</td>
        <td><strong>Expert</strong></td>
        <td>Small advantage</td>
    </tr>
    <tr>
        <td>Colon</td>
        <td class="center">288</td>
        <td class="right">-0.068</td>
        <td class="right">[-0.086, -0.050]</td>
        <td>Unified</td>
        <td>Medium advantage</td>
    </tr>
    <tr>
        <td>Adrenal_gland</td>
        <td class="center">88</td>
        <td class="right">-0.111</td>
        <td class="right">[-0.142, -0.080]</td>
        <td>Unified</td>
        <td>Medium advantage</td>
    </tr>
    <tr>
        <td>Bile-duct</td>
        <td class="center">84</td>
        <td class="right">-0.199</td>
        <td class="right">[-0.228, -0.168]</td>
        <td>Unified</td>
        <td>Large advantage</td>
    </tr>
    <tr>
        <td>Esophagus</td>
        <td class="center">85</td>
        <td class="right">-0.285</td>
        <td class="right">[-0.328, -0.243]</td>
        <td>Unified</td>
        <td>Large advantage</td>
    </tr>
</table>

<div class="warning">
    <p><strong>Tissue Heterogeneity:</strong> Only Breast tissue shows expert model advantage. This may be due to: (1) Largest sample size (n=471) providing more training data for expert model, or (2) Breast tissue characteristics being more distinct and benefiting from specialization.</p>
</div>

<h2>6. Statistical Assumptions and Diagnostics</h2>

<h3>6.1 Wilcoxon Signed-Rank Assumptions</h3>
<ul class="checklist">
    <li><strong>Paired observations:</strong> ‚úÖ Each image has both expert and unified predictions</li>
    <li><strong>Ordinal or continuous data:</strong> ‚úÖ PQ is continuous metric [0,1]</li>
    <li><strong>Symmetric distribution of differences:</strong> ‚ö†Ô∏è Not strictly required for rank test, but affects interpretation</li>
    <li><strong>Independence:</strong> ‚ö†Ô∏è Potential tissue clustering (addressed by mixed-effects)</li>
</ul>

<h3>6.2 Mixed-Effects Model Assumptions</h3>
<ul class="checklist">
    <li><strong>Linear relationship:</strong> ‚úÖ Simple intercept-only model</li>
    <li><strong>Normal residuals:</strong> ‚ö†Ô∏è Not critical with large sample (n=1,016)</li>
    <li><strong>Homoscedasticity:</strong> ‚ö†Ô∏è Segmentation metrics may have heterogeneous variance</li>
    <li><strong>Random effects normality:</strong> ‚úÖ Only 5 tissues, reasonable assumption</li>
</ul>

<h2>7. Interpretation and Clinical Significance</h2>

<div class="highlight">
    <h3>7.1 Statistical vs. Clinical Significance</h3>
    <p><strong>Observed Effect:</strong> Median difference = -0.0147 PQ units</p>
    <p><strong>Detectable Effect:</strong> MDES = 0.0134 PQ units</p>
    <p><strong>Conclusion:</strong> The observed effect exceeds our detection threshold, indicating both statistical power and practical relevance.</p>
</div>

<div class="result">
    <h3>7.2 Effect Size Guidelines (Cohen's Conventions Adapted)</h3>
    <table>
        <tr>
            <th>Effect Size</th>
            <th>Rank-biserial |r|</th>
            <th>Interpretation</th>
            <th>Our Finding</th>
        </tr>
        <tr>
            <td>Small</td>
            <td>0.1 - 0.3</td>
            <td>Detectable but modest</td>
            <td>‚úÖ r = -0.276</td>
        </tr>
        <tr>
            <td>Medium</td>
            <td>0.3 - 0.5</td>
            <td>Moderate practical importance</td>
            <td>‚ùå</td>
        </tr>
        <tr>
            <td>Large</td>
            <td>> 0.5</td>
            <td>Strong practical significance</td>
            <td>‚ùå</td>
        </tr>
    </table>
</div>

<h2>8. Limitations and Future Directions</h2>

<div class="warning">
    <h3>8.1 Study Limitations</h3>
    <ul>
        <li><strong>Cross-sectional design:</strong> Single timepoint evaluation; no temporal validation</li>
        <li><strong>Dataset-specific:</strong> Results may not generalize beyond PanNuke dataset characteristics</li>
        <li><strong>Model architecture:</strong> Only U-Net tested; other architectures might show different patterns</li>
        <li><strong>Training epochs:</strong> Limited training (1 epoch) may not reflect optimal performance</li>
        <li><strong>Ensemble methods:</strong> Simple averaging; more sophisticated ensemble techniques not explored</li>
    </ul>
</div>

<div class="highlight">
    <h3>8.2 Future Research Directions</h3>
    <ul>
        <li><strong>Architecture comparison:</strong> Test expert vs. unified approach with transformer-based models</li>
        <li><strong>Training optimization:</strong> Longer training with early stopping and hyperparameter tuning</li>
        <li><strong>Advanced ensembling:</strong> Weighted voting, stacking, or meta-learning approaches</li>
        <li><strong>External validation:</strong> Test on independent histopathology datasets</li>
        <li><strong>Cost-benefit analysis:</strong> Compare computational costs vs. performance gains</li>
    </ul>
</div>

<h2>9. Files and Reproducibility</h2>

<div class="file-ref">
    <h3>9.1 Analysis Files</h3>
    <p><strong>Primary Data:</strong></p>
    <ul>
        <li><code>artifacts/rq2/results/per_image_metrics.csv</code> - Per-image paired predictions (1,016 rows)</li>
        <li><code>artifacts/rq2/results/summary_rq2.csv</code> - Main statistical summary</li>
    </ul>
    
    <p><strong>Statistical Results:</strong></p>
    <ul>
        <li><code>artifacts/rq2/results/bh_adjusted.csv</code> - Multiple comparisons with FDR correction</li>
        <li><code>artifacts/rq2/results/forest_pq.csv</code> - Tissue-specific estimates with confidence intervals</li>
        <li><code>artifacts/rq2/results/report_sentences.txt</code> - Paste-ready text for manuscript</li>
    </ul>
    
    <p><strong>Visualizations:</strong></p>
    <ul>
        <li><code>artifacts/rq2/results/figures/hist_delta_pq.png</code> - Distribution of differences</li>
        <li><code>artifacts/rq2/results/figures/box_by_tissue_delta_pq.png</code> - Per-tissue comparisons</li>
        <li><code>artifacts/rq2/results/figures/forest_delta_pq.png</code> - Forest plot with confidence intervals</li>
        <li><code>artifacts/rq2/results/figures/violin_delta_pq.png</code> - Violin plot of differences</li>
    </ul>
</div>

<div class="file-ref">
    <h3>9.2 Code Reproducibility</h3>
    <p><strong>Analysis Scripts:</strong></p>
    <ul>
        <li><code>src/evaluation/collect_per_image_metrics.py</code> - Generate paired metrics</li>
        <li><code>src/stats/analyze_rq2.py</code> - Statistical analysis pipeline</li>
        <li><code>scripts/eval_and_stats.sh</code> - Complete evaluation pipeline</li>
    </ul>
    
    <p><strong>Execution:</strong></p>
    <pre><code>BATCH_SIZE=8 ./scripts/eval_and_stats.sh</code></pre>
</div>

<h2>10. Conclusion</h2>

<div class="result">
    <p><strong>Research Question 2 Answer:</strong></p>
    <p>Expert segmentation models trained individually per tissue do <strong>NOT</strong> outperform unified models trained across all PanNuke classes. The unified approach demonstrates superior performance across all evaluated metrics (PQ, Dice, AJI, F1) with the exception of Breast tissue, where expert models show modest advantage.</p>
    
    <p><strong>Statistical Evidence:</strong></p>
    <ul>
        <li>Wilcoxon signed-rank test: p = 1.000 (no evidence for expert superiority)</li>
        <li>Effect size: r = -0.276 (small-to-medium effect favoring unified)</li>
        <li>All secondary metrics consistent with primary finding</li>
        <li>Mixed-effects analysis confirms results after accounting for tissue clustering</li>
    </ul>
    
    <p><strong>Practical Implications:</strong> The unified model approach is recommended for PanNuke-style segmentation tasks, offering computational efficiency and superior performance across diverse tissue types.</p>
</div>

<hr>
<p><em>Report generated: <script>document.write(new Date().toLocaleString())</script></em></p>
<p><em>Analysis conducted using per-image paired comparisons with robust statistical methods and appropriate multiple testing corrections.</em></p>

</body>
</html>
